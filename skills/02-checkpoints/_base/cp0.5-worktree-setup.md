# Checkpoint 0.5: Worktree æº–å‚™ - éš”é›¢ç’°å¢ƒå»ºç«‹

> ğŸ”’ **æ¢ä»¶æ€§æª¢æŸ¥é»** - ç¬¦åˆæ¢ä»¶æ™‚å¼·åˆ¶åŸ·è¡Œ
>
> ğŸ’¡ **æ ¸å¿ƒåƒ¹å€¼**ï¼šç‚ºé«˜é¢¨éšªä»»å‹™å»ºç«‹å®‰å…¨çš„éš”é›¢ç’°å¢ƒ

## è¦å‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”’ Worktree æº–å‚™ï¼ˆæ¢ä»¶è§¸ç™¼ï¼‰                                    â”‚
â”‚                                                                 â”‚
â”‚  CP0 åŒ—æ¥µæ˜ŸéŒ¨å®šå¾Œï¼Œåˆ¤æ–·æ˜¯å¦éœ€è¦éš”é›¢ç’°å¢ƒï¼š                        â”‚
â”‚                                                                 â”‚
â”‚  å¼·åˆ¶è§¸ç™¼æ¢ä»¶ï¼ˆä»»ä¸€ï¼‰ï¼š                                          â”‚
â”‚  â€¢ æ¶æ§‹ç­‰ç´š Level 2ï¼ˆæ–°æ¨¡çµ„/æœå‹™/æ•´åˆï¼‰                         â”‚
â”‚  â€¢ --autonomous æ¨¡å¼                                            â”‚
â”‚  â€¢ spec-workflow ä¸¦è¡Œä»»å‹™                                       â”‚
â”‚  â€¢ ç”¨æˆ¶æ˜ç¢ºè¦æ±‚éš”é›¢                                             â”‚
â”‚                                                                 â”‚
â”‚  å»ºè­°è§¸ç™¼æ¢ä»¶ï¼ˆä»»ä¸€ï¼‰ï¼š                                          â”‚
â”‚  â€¢ é æœŸåŸ·è¡Œæ™‚é–“ > 30 åˆ†é˜                                       â”‚
â”‚  â€¢ æ¶‰åŠæ ¸å¿ƒæ¨¡çµ„ä¿®æ”¹                                             â”‚
â”‚  â€¢ å¯¦é©—æ€§é–‹ç™¼ï¼ˆã€Œè©¦è©¦çœ‹ã€ã€Œå¯¦é©—ä¸€ä¸‹ã€ï¼‰                          â”‚
â”‚                                                                 â”‚
â”‚  âŒ ä¸è§¸ç™¼ï¼šLevel 0 å°ä¿®æ”¹ã€ç´”æ¢ç´¢ã€Memory æ“ä½œ                  â”‚
â”‚  âœ… è§¸ç™¼å¾Œï¼šæ‰€æœ‰å¾ŒçºŒ CP åœ¨ Worktree å…§åŸ·è¡Œ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è§¸ç™¼æ¢ä»¶

| æ¢ä»¶ | æ˜¯å¦è§¸ç™¼ | åŸå›  |
|------|----------|------|
| Level 2 æ¶æ§‹ä»»å‹™ | âœ… å¼·åˆ¶ | é¢¨éšªé«˜ï¼Œéœ€è¦å®‰å…¨é‚Šç•Œ |
| `--autonomous` æ¨¡å¼ | âœ… å¼·åˆ¶ | è‡ªä¸»æ¢ç´¢éœ€è¦å¯å›æ»¾ |
| spec-workflow ä¸¦è¡Œ | âœ… å¼·åˆ¶ | å¤šä»»å‹™åŒæ™‚åŸ·è¡Œ |
| Level 1 + æ™‚é–“ > 30min | âœ… å»ºè­° | é•·æ™‚é–“ä»»å‹™é¢¨éšªè¼ƒé«˜ |
| Level 0 å°ä¿®æ”¹ | âŒ è·³é | æˆæœ¬å¤§æ–¼æ”¶ç›Š |
| ç´” Memory æ“ä½œ | âŒ è·³é | ä¸å½±éŸ¿ç¨‹å¼ç¢¼ |

## åŸ·è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CP0.5 åŸ·è¡Œæµç¨‹                               â”‚
â”‚                                                                 â”‚
â”‚              CP0 åŒ—æ¥µæ˜ŸéŒ¨å®šå®Œæˆ                                  â”‚
â”‚                       â†“                                         â”‚
â”‚               åˆ¤æ–·æ˜¯å¦éœ€è¦ Worktree                              â”‚
â”‚                       â”‚                                         â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚         â†“                           â†“                           â”‚
â”‚      éœ€è¦                        ä¸éœ€è¦                         â”‚
â”‚         â†“                           â†“                           â”‚
â”‚   é¸æ“‡ç›®éŒ„ä½ç½®                  è·³é CP0.5                       â”‚
â”‚         â†“                           â†“                           â”‚
â”‚   é©—è­‰ gitignore               ç›´æ¥é€²å…¥ CP1                      â”‚
â”‚         â†“                                                       â”‚
â”‚   å»ºç«‹ Worktree                                                 â”‚
â”‚         â†“                                                       â”‚
â”‚   åˆ‡æ›åˆ° Worktree                                               â”‚
â”‚         â†“                                                       â”‚
â”‚   å®‰è£ä¾è³´                                                      â”‚
â”‚         â†“                                                       â”‚
â”‚   é©—è­‰åŸºç·šæ¸¬è©¦                                                  â”‚
â”‚         â”‚                                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                                  â”‚
â”‚    â†“         â†“                                                  â”‚
â”‚  é€šé      å¤±æ•—                                                 â”‚
â”‚    â†“         â†“                                                  â”‚
â”‚ é€²å…¥ CP1   å ±å‘Šå•é¡Œ                                             â”‚
â”‚            è©¢å•æ˜¯å¦ç¹¼çºŒ                                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Step 1: é¸æ“‡ç›®éŒ„ä½ç½®

### å„ªå…ˆé †åº

```bash
# 1. æª¢æŸ¥ .worktrees/ æ˜¯å¦å­˜åœ¨
ls -d .worktrees 2>/dev/null && echo "ä½¿ç”¨ .worktrees/"

# 2. æª¢æŸ¥ worktrees/ æ˜¯å¦å­˜åœ¨
ls -d worktrees 2>/dev/null && echo "ä½¿ç”¨ worktrees/"

# 3. æª¢æŸ¥ CLAUDE.md æ˜¯å¦æœ‰æŒ‡å®š
grep -i "worktree.*director" CLAUDE.md 2>/dev/null

# 4. é è¨­ä½¿ç”¨ .worktrees/
```

### é¸æ“‡é‚è¼¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç›®éŒ„é¸æ“‡é‚è¼¯                                                   â”‚
â”‚                                                                 â”‚
â”‚  .worktrees/ å­˜åœ¨ï¼Ÿ                                             â”‚
â”‚       â†“ Yes              â†“ No                                   â”‚
â”‚    ä½¿ç”¨å®ƒ           worktrees/ å­˜åœ¨ï¼Ÿ                           â”‚
â”‚                          â†“ Yes              â†“ No                â”‚
â”‚                       ä½¿ç”¨å®ƒ          CLAUDE.md æœ‰æŒ‡å®šï¼Ÿ        â”‚
â”‚                                            â†“ Yes         â†“ No  â”‚
â”‚                                         ä¾æŒ‡å®š     ä½¿ç”¨ .worktrees/ â”‚
â”‚                                                                 â”‚
â”‚  å…©è€…éƒ½å­˜åœ¨æ™‚ï¼Œå„ªå…ˆä½¿ç”¨ .worktrees/ï¼ˆéš±è—ç›®éŒ„ï¼‰                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Step 2: é©—è­‰ gitignore

> âš ï¸ **é—œéµæ­¥é©Ÿ** - é˜²æ­¢ worktree å…§å®¹è¢«æ„å¤–æäº¤

```bash
# æª¢æŸ¥ç›®éŒ„æ˜¯å¦å·²è¢«å¿½ç•¥
git check-ignore -q .worktrees 2>/dev/null
```

### å¦‚æœæ²’è¢«å¿½ç•¥

```bash
# ç«‹å³ä¿®å¾©
echo ".worktrees/" >> .gitignore
git add .gitignore
git commit -m "chore: ignore worktrees directory"
```

### ç‚ºä»€éº¼é‡è¦

- Worktree å…§å®¹è‹¥è¢«è¿½è¹¤ï¼Œæœƒæ±¡æŸ“ git status
- å¯èƒ½æ„å¤– commit å¯¦é©—æ€§ç¨‹å¼ç¢¼åˆ°ä¸»åˆ†æ”¯
- é€ æˆ repository æ··äº‚

## Step 3: å»ºç«‹ Worktree

### å‘½åè¦å‰‡

```
.worktrees/{task-id}/
         â””â”€â”€ feature/{task-id}  â† åˆ†æ”¯åç¨±
```

**task-id æ ¼å¼**ï¼š
- spec-workflow ä»»å‹™ï¼š`T001`, `T002`
- ä¸€èˆ¬ä»»å‹™ï¼š`{æ—¥æœŸ}-{ç°¡çŸ­æè¿°}` (ä¾‹ï¼š`0115-auth-refactor`)
- autonomous ä»»å‹™ï¼š`auto-{timestamp}`

### å»ºç«‹æŒ‡ä»¤

```bash
# å–å¾—å°ˆæ¡ˆåç¨±ï¼ˆç”¨æ–¼å…¨åŸŸä½ç½®ï¼‰
PROJECT=$(basename "$(git rev-parse --show-toplevel)")

# å»ºç«‹ worktree + æ–°åˆ†æ”¯
git worktree add .worktrees/{task-id} -b feature/{task-id}

# é©—è­‰å»ºç«‹æˆåŠŸ
git worktree list
```

## Step 4: åˆ‡æ›ä¸¦å®‰è£ä¾è³´

```bash
# åˆ‡æ›åˆ° worktree
cd .worktrees/{task-id}

# è‡ªå‹•åµæ¸¬ä¸¦å®‰è£ä¾è³´
if [ -f package.json ]; then
    npm install
elif [ -f pnpm-lock.yaml ]; then
    pnpm install
elif [ -f yarn.lock ]; then
    yarn install
elif [ -f requirements.txt ]; then
    pip install -r requirements.txt
elif [ -f pyproject.toml ]; then
    poetry install
elif [ -f Cargo.toml ]; then
    cargo build
elif [ -f go.mod ]; then
    go mod download
fi
```

## Step 5: é©—è­‰åŸºç·šæ¸¬è©¦

```bash
# åŸ·è¡Œæ¸¬è©¦
npm test                    # Node.js
pytest                      # Python
cargo test                  # Rust
go test ./...               # Go

# é æœŸçµæœï¼šæ‰€æœ‰æ¸¬è©¦é€šé
```

### æ¸¬è©¦å¤±æ•—è™•ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ åŸºç·šæ¸¬è©¦å¤±æ•—                                                â”‚
â”‚                                                                 â”‚
â”‚  æ¸¬è©¦çµæœï¼š5 passed, 2 failed                                   â”‚
â”‚                                                                 â”‚
â”‚  å¤±æ•—çš„æ¸¬è©¦ï¼š                                                   â”‚
â”‚  â€¢ test_user_login - AssertionError                            â”‚
â”‚  â€¢ test_api_response - TimeoutError                            â”‚
â”‚                                                                 â”‚
â”‚  é€™äº›æ¸¬è©¦åœ¨å»ºç«‹ Worktree å‰å°±å·²ç¶“å¤±æ•—ã€‚                         â”‚
â”‚  ä½ æƒ³è¦ï¼š                                                       â”‚
â”‚                                                                 â”‚
â”‚  A) ç¹¼çºŒï¼ˆè¨˜éŒ„é€™äº›æ˜¯æ—¢æœ‰å•é¡Œï¼‰                                  â”‚
â”‚  B) å–æ¶ˆï¼ˆå…ˆä¿®å¾©ä¸»åˆ†æ”¯çš„æ¸¬è©¦ï¼‰                                  â”‚
â”‚  C) å¿½ç•¥å¤±æ•—çš„æ¸¬è©¦ç¹¼çºŒ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®Œæˆä¿¡è™Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Worktree æº–å‚™å®Œæˆ                                           â”‚
â”‚                                                                 â”‚
â”‚  ä½ç½®ï¼š/path/to/project/.worktrees/{task-id}                    â”‚
â”‚  åˆ†æ”¯ï¼šfeature/{task-id}                                        â”‚
â”‚  æ¸¬è©¦ï¼š47 passed, 0 failed                                      â”‚
â”‚                                                                 â”‚
â”‚  â†’ é€²å…¥ CP1: Memory æœå°‹                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## éŒ¯èª¤è™•ç†

### å¸¸è¦‹éŒ¯èª¤

| éŒ¯èª¤ | åŸå›  | è§£æ±ºæ–¹æ¡ˆ |
|------|------|----------|
| `fatal: already exists` | åŒå worktree å·²å­˜åœ¨ | ä½¿ç”¨ä¸åŒåç¨±æˆ–æ¸…ç†èˆŠçš„ |
| `fatal: is already checked out` | åˆ†æ”¯å·²åœ¨å…¶ä»–åœ°æ–¹ checkout | ä½¿ç”¨ä¸åŒåˆ†æ”¯å |
| ä¾è³´å®‰è£å¤±æ•— | ç¶²è·¯å•é¡Œæˆ–ç‰ˆæœ¬è¡çª | é‡è©¦æˆ–æ‰‹å‹•è§£æ±º |
| æ¸¬è©¦å…¨éƒ¨å¤±æ•— | ç’°å¢ƒå•é¡Œ | æª¢æŸ¥ç’°å¢ƒé…ç½® |

### å›æ»¾æ©Ÿåˆ¶

```bash
# å¦‚æœ CP0.5 ä»»ä½•æ­¥é©Ÿå¤±æ•—
git worktree remove .worktrees/{task-id} --force 2>/dev/null
git branch -D feature/{task-id} 2>/dev/null

# å ±å‘Šå¤±æ•—ï¼Œå›é€€åˆ° main åˆ†æ”¯åŸ·è¡Œ
```

## èˆ‡å…¶ä»–æª¢æŸ¥é»çš„é—œä¿‚

```
CP0 (åŒ—æ¥µæ˜ŸéŒ¨å®š)
     â†“
CP0.5 (Worktree æº–å‚™) â† ä½ åœ¨é€™è£¡
     â†“
CP1 (Memory æœå°‹) â† åœ¨ Worktree å…§åŸ·è¡Œ
     â†“
... æ‰€æœ‰å¾ŒçºŒ CP éƒ½åœ¨ Worktree å…§ ...
     â†“
CP6.5 (Worktree å®Œæˆ) â† åˆä½µæˆ–æ¸…ç†
```

## ç›¸é—œè³‡æº

- [éš”é›¢ç’°å¢ƒæ¦‚è¿°](../../06-scaling/_base/isolated-environments.md)
- [CP6.5: Worktree å®Œæˆ](./cp6.5-worktree-completion.md)
- [Git Worktree å®˜æ–¹æ–‡æª”](https://git-scm.com/docs/git-worktree)
