# 目標分析 (Phase 1)

> 執行任務前的目標解析與明確性檢查

## 目標明確性檢查（優先執行）

```
┌─────────────────────────────────────────────────────────┐
│  檢查項目：                                             │
│  □ 有具體的成功標準嗎？                                │
│  □ 有可量化的驗收條件嗎？                              │
│  □ 範圍是否明確？                                      │
│  □ 有技術/資源約束嗎？                                 │
│  □ 有時間/品質偏好嗎？                                 │
│  □ 需要架構設計嗎？（見下方判斷標準）                  │
└─────────────────────────────────────────────────────────┘

若有 ≥2 項不明確 → 使用 AskUserQuestion 確認
若只有 1 項不明確 → 用【假設】補齊，列出假設內容
若全部明確 → 直接進入目標解析
```

## 架構考量觸發判斷

根據任務性質，判斷是否需要在 PDCA Plan 階段進行架構設計：

```
┌─────────────────────────────────────────────────────────────────┐
│  架構設計需求等級                                               │
│                                                                 │
│  Level 0: 不需要架構設計                                        │
│  ├─ Bug fix（修復現有功能）                                     │
│  ├─ 小幅修改（調整參數、文案、樣式）                           │
│  ├─ 單一函數/方法的變更                                        │
│  └─ 文檔更新                                                   │
│                                                                 │
│  Level 1: 輕量架構思考（PDCA Plan 時快速考慮）                  │
│  ├─ 新增單一功能（在現有模組內）                               │
│  ├─ 重構現有程式碼（不改變介面）                               │
│  └─ 效能優化                                                   │
│                                                                 │
│  Level 2: 完整架構設計（PDCA Plan 時深度考慮）                  │
│  ├─ 新增模組/服務                                              │
│  ├─ 跨多個模組的功能                                          │
│  ├─ 新增外部整合（API、資料庫、第三方服務）                   │
│  ├─ 變更核心架構/資料模型                                     │
│  └─ 建立新專案                                                │
└─────────────────────────────────────────────────────────────────┘
```

### 快速判斷表

| 任務特徵 | 架構等級 | Plan 階段行為 |
|----------|----------|---------------|
| 改個 bug、調參數 | Level 0 | 直接執行 |
| 新增一個 API endpoint | Level 1 | 快速考慮錯誤處理、命名 |
| 新增一個完整功能模組 | Level 2 | 完整架構設計流程 |
| 重構認證系統 | Level 2 | 完整架構設計流程 |
| 整合新的第三方服務 | Level 2 | 完整架構設計流程 |

### 標記方式

在目標分析完成後，標記架構等級：

```yaml
goal_analysis:
  goal: "建立用戶通知系統"
  architecture_level: 2  # 0, 1, or 2
  architecture_reason: "新增完整模組，涉及多種通知管道"
```

此標記會影響 PDCA Plan 階段的深度。

## 目標解析步驟

1. **解析目標**
   - 最終成功標準是什麼？
   - 如何驗證目標達成？
   - 有哪些約束條件？

2. **分解子目標**
   - 將大目標拆成可執行的步驟
   - 識別依賴關係
   - 設定每個步驟的驗收標準

3. **評估現有能力**
   - 需要哪些技能/工具？
   - 哪些已具備？哪些需要學習？

## 目標確認問卷（使用 AskUserQuestion）

當目標不明確時，**一次收齊**關鍵資訊：

```
┌─────────────────────────────────────────────────────────────────┐
│  ❓ 需要確認目標細節                                           │
│                                                                 │
│  您的目標：[用戶輸入的原始目標]                                 │
│                                                                 │
│  請幫我確認以下幾點：                                           │
│                                                                 │
│  1. 成功標準                                                    │
│     □ 能正常運作即可                                           │
│     □ 需要特定效能指標（請說明）                               │
│     □ 需要通過測試/驗收條件（請說明）                          │
│                                                                 │
│  2. 範圍限制                                                    │
│     □ 只處理核心功能                                           │
│     □ 需要完整實作（含邊界情況）                               │
│     □ 需要考慮擴展性                                           │
│                                                                 │
│  3. 品質 vs 速度                                                │
│     □ 快速完成優先（可接受後續優化）                           │
│     □ 品質優先（寧可慢也要做好）                               │
│     □ 平衡                                                     │
│                                                                 │
│  4. 其他約束                                                    │
│     □ 無特別限制                                               │
│     □ 有（請說明：技術棧/相容性/資源限制）                     │
└─────────────────────────────────────────────────────────────────┘
```

## 不明確目標範例

| 用戶輸入 | 缺少的資訊 | 需要確認 |
|----------|------------|----------|
| 「優化效能」 | 優化什麼？目標數值？ | ✅ |
| 「做一個網站」 | 什麼功能？什麼風格？ | ✅ |
| 「修好這個 bug」 | bug 現象？預期行為？ | ✅ |
| 「把這段程式碼重構成 TypeScript，要有型別定義」 | 全部明確 | ❌ |
| 「建立登入功能，要有 JWT 和刷新 token」 | 全部明確 | ❌ |
