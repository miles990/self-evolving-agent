# éš”é›¢ç’°å¢ƒ - Git Worktree å·¥ä½œæµç¨‹

> ğŸ”’ **é«˜é¢¨éšªä»»å‹™ä¿è­·** - é¿å…ä»»å‹™å¤±æ•—æ±¡æŸ“ä¸»åˆ†æ”¯
>
> ğŸ’¡ **æ ¸å¿ƒåƒ¹å€¼**ï¼šå¤±æ•—å¯å›æ»¾ã€ä¸¦è¡Œå¯åŸ·è¡Œã€å¯¦é©—ç„¡é¡§æ…®

## æ¦‚è¿°

Git Worktree è®“ä½ åœ¨åŒä¸€å€‹ repository ä¸­åŒæ™‚æ“æœ‰å¤šå€‹å·¥ä½œç›®éŒ„ï¼Œæ¯å€‹ç›®éŒ„å¯ä»¥åœ¨ä¸åŒåˆ†æ”¯ä¸Šå·¥ä½œï¼Œä¸”å…±äº«åŒä¸€å€‹ `.git` è³‡æ–™åº«ã€‚

```
ä¸»å·¥ä½œå€ (main)              éš”é›¢å·¥ä½œå€ (worktree)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç©©å®šç¨‹å¼ç¢¼   â”‚            â”‚ å¯¦é©—æ€§é–‹ç™¼   â”‚
â”‚ ä¸å—å¹²æ“¾     â”‚  â†å…±äº«â†’   â”‚ ç¨ç«‹åˆ†æ”¯     â”‚
â”‚ éš¨æ™‚å¯ç”¨     â”‚   .git     â”‚ å¯éš¨æ™‚åˆªé™¤   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è§¸ç™¼æ¢ä»¶

### å¼·åˆ¶ä½¿ç”¨ Worktree

| æ¢ä»¶ | åŸå›  |
|------|------|
| æ¶æ§‹ç­‰ç´š Level 2 | æ–°æ¨¡çµ„/æœå‹™/æ•´åˆï¼Œé¢¨éšªé«˜ |
| `--autonomous` æ¨¡å¼ | è‡ªä¸»æ¢ç´¢ï¼Œéœ€è¦å®‰å…¨é‚Šç•Œ |
| spec-workflow ä¸¦è¡Œä»»å‹™ | å¤šä»»å‹™åŒæ™‚åŸ·è¡Œ |
| æ˜ç¢ºå¯¦é©—æ€§é–‹ç™¼ | ç”¨æˆ¶èªªã€Œè©¦è©¦çœ‹ã€ã€Œå¯¦é©—ä¸€ä¸‹ã€ |

### å»ºè­°ä½¿ç”¨ Worktree

| æ¢ä»¶ | åŸå›  |
|------|------|
| é æœŸåŸ·è¡Œæ™‚é–“ > 30 åˆ†é˜ | é•·æ™‚é–“ä»»å‹™é¢¨éšªè¼ƒé«˜ |
| æ¶‰åŠæ ¸å¿ƒæ¨¡çµ„ä¿®æ”¹ | å½±éŸ¿ç¯„åœå¤§ |
| ç”¨æˆ¶è¦æ±‚éš”é›¢ | æ˜ç¢ºéœ€æ±‚ |

### ä¸éœ€è¦ Worktree

| æ¢ä»¶ | åŸå›  |
|------|------|
| Level 0 å°ä¿®æ”¹ | Bug fixã€typoï¼Œæˆæœ¬å¤§æ–¼æ”¶ç›Š |
| ç´”æ¢ç´¢/ç ”ç©¶ | ä¸ç”¢ç”Ÿç¨‹å¼ç¢¼è®Šæ›´ |
| Memory æ“ä½œ | åªè®€/å¯«è¨˜æ†¶ï¼Œä¸å½±éŸ¿ç¨‹å¼ç¢¼ |

## æ•´åˆåˆ° Evolve æµç¨‹

### æ–°å¢æª¢æŸ¥é»

```
CP0: åŒ—æ¥µæ˜ŸéŒ¨å®š
    â†“
CP0.5: Worktree æº–å‚™ â† æ–°å¢ï¼ˆæ¢ä»¶è§¸ç™¼ï¼‰
    â†“
CP1 ~ CP6: åœ¨ Worktree å…§åŸ·è¡Œ
    â†“
CP6.5: Worktree å®Œæˆ â† æ–°å¢ï¼ˆæ¸…ç†/åˆä½µï¼‰
```

### æ±ºç­–æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Worktree æ±ºç­–æµç¨‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                     ä»»å‹™é–‹å§‹ (CP0 å¾Œ)                           â”‚
â”‚                           â†“                                     â”‚
â”‚                   éœ€è¦ Worktree å—ï¼Ÿ                            â”‚
â”‚                           â”‚                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚         â”‚                 â”‚                 â”‚                   â”‚
â”‚         â†“                 â†“                 â†“                   â”‚
â”‚    Level 2?      --autonomous?      ä¸¦è¡Œä»»å‹™?                   â”‚
â”‚         â”‚                 â”‚                 â”‚                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                  â”‚                 â”‚                            â”‚
â”‚              ä»»ä¸€ç‚ºæ˜¯           å…¨éƒ¨ç‚ºå¦                         â”‚
â”‚                  â†“                 â†“                            â”‚
â”‚            CP0.5 å»ºç«‹         ç›´æ¥åœ¨ main                       â”‚
â”‚            Worktree           åŸ·è¡Œ PDCA                         â”‚
â”‚                  â”‚                 â”‚                            â”‚
â”‚                  â†“                 â†“                            â”‚
â”‚           åœ¨ Worktree         æ­£å¸¸å®Œæˆ                          â”‚
â”‚           ä¸­åŸ·è¡Œ PDCA              â”‚                            â”‚
â”‚                  â”‚                 â”‚                            â”‚
â”‚                  â†“                 â†“                            â”‚
â”‚            CP6.5 å®Œæˆ         çµæŸæµç¨‹                          â”‚
â”‚            (åˆä½µ/æ¸…ç†)                                          â”‚
â”‚                  â”‚                                              â”‚
â”‚                  â†“                                              â”‚
â”‚             çµæŸæµç¨‹                                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## CP0.5: Worktree æº–å‚™

> è©³è¦‹ [../02-checkpoints/_base/cp0.5-worktree-setup.md](../../02-checkpoints/_base/cp0.5-worktree-setup.md)

### ç›®éŒ„é¸æ“‡å„ªå…ˆé †åº

1. æª¢æŸ¥ `.worktrees/` æ˜¯å¦å­˜åœ¨ â†’ ä½¿ç”¨
2. æª¢æŸ¥ `worktrees/` æ˜¯å¦å­˜åœ¨ â†’ ä½¿ç”¨
3. æª¢æŸ¥ `CLAUDE.md` æ˜¯å¦æœ‰æŒ‡å®š â†’ ä¾æŒ‡å®š
4. é è¨­ä½¿ç”¨ `.worktrees/`

### å»ºç«‹æµç¨‹æ‘˜è¦

```bash
# 1. ç¢ºä¿ç›®éŒ„è¢« gitignore
git check-ignore -q .worktrees || echo ".worktrees/" >> .gitignore

# 2. å»ºç«‹ worktree
git worktree add .worktrees/{task-id} -b feature/{task-id}

# 3. é€²å…¥ä¸¦å®‰è£ä¾è³´
cd .worktrees/{task-id}
npm install  # æˆ–å…¶ä»–å¥—ä»¶ç®¡ç†å™¨

# 4. é©—è­‰åŸºç·šæ¸¬è©¦é€šé
npm test
```

## CP6.5: Worktree å®Œæˆ

> è©³è¦‹ [../02-checkpoints/_base/cp6.5-worktree-completion.md](../../02-checkpoints/_base/cp6.5-worktree-completion.md)

### æˆåŠŸæ™‚ï¼šåˆä½µ + æ¸…ç†

```bash
# å›åˆ°ä¸»ç›®éŒ„
cd /path/to/main

# åˆä½µ
git merge feature/{task-id}

# æ¸…ç†
git worktree remove .worktrees/{task-id}
git branch -d feature/{task-id}
```

### å¤±æ•—æ™‚ï¼šè¨˜éŒ„ + åˆªé™¤

```bash
# åŸ·è¡Œ CP5 å¤±æ•—é©—å±ï¼ˆåœ¨ worktree å…§ï¼‰

# è¨˜éŒ„æ•™è¨“å¾Œï¼Œç›´æ¥åˆªé™¤
git worktree remove .worktrees/{task-id} --force
git branch -D feature/{task-id}
```

### æš«åœæ™‚ï¼šä¿ç•™ç‹€æ…‹

```bash
# è¨˜éŒ„ç•¶å‰ç‹€æ…‹åˆ°åŒ—æ¥µæ˜Ÿæ–‡ä»¶
# Worktree ä¿ç•™ï¼Œä¸‹æ¬¡ç¹¼çºŒ
```

## ä¸¦è¡Œä»»å‹™æ”¯æ´

Worktree çš„ä¸€å¤§å„ªå‹¢æ˜¯æ”¯æ´å¤šä»»å‹™ä¸¦è¡Œï¼š

```
.worktrees/
â”œâ”€â”€ task-001/          # åŠŸèƒ½ A é–‹ç™¼
â”‚   â””â”€â”€ feature/task-001
â”œâ”€â”€ task-002/          # åŠŸèƒ½ B é–‹ç™¼
â”‚   â””â”€â”€ feature/task-002
â””â”€â”€ task-003/          # Bug ä¿®å¾©
    â””â”€â”€ bugfix/task-003
```

### èˆ‡ spec-workflow æ•´åˆ

ç•¶ spec-workflow ç”¢ç”Ÿå¤šå€‹ç¨ç«‹ä»»å‹™æ™‚ï¼š

```bash
# å¾ spec å–å¾—ä»»å‹™åˆ—è¡¨
/tech-spec-gen tasks

# ç‚ºæ¯å€‹ç¨ç«‹ä»»å‹™å»ºç«‹ worktree
/evolve --from-spec my-feature T001  # â†’ .worktrees/T001
/evolve --from-spec my-feature T002  # â†’ .worktrees/T002 (ä¸¦è¡Œ)

# å®Œæˆå¾Œä¾åºåˆä½µ
```

## å„ªå‹¢èˆ‡åƒ¹å€¼

| å„ªå‹¢ | èªªæ˜ | å° evolve çš„åƒ¹å€¼ |
|------|------|------------------|
| **å¤±æ•—éš”é›¢** | ä»»å‹™å¤±æ•—ä¸æ±¡æŸ“ main | `--autonomous` æ›´å®‰å…¨ |
| **ä¸¦è¡Œèƒ½åŠ›** | å¤š worktree åŒæ™‚åŸ·è¡Œ | spec-workflow ä¸¦è¡Œä»»å‹™ |
| **ä¹¾æ·¨å›æ»¾** | `git worktree remove` å³å¯ | CP5 å¤±æ•—å¾Œå¿«é€Ÿæ¢å¾© |
| **å¯¦é©—å®‰å…¨** | éš¨ä¾¿å˜—è©¦ä¸æ€•å¼„å£ | Level 2 æ¶æ§‹æ¢ç´¢æ›´è‡ªç”± |
| **æ¸¬è©¦åŸºç·š** | å»ºç«‹æ™‚é©—è­‰æ¸¬è©¦é€šé | å€åˆ†æ–° bug vs åŸæœ‰ bug |

## é™åˆ¶èˆ‡æ³¨æ„äº‹é …

### æˆæœ¬è€ƒé‡

- **ç£ç¢Ÿç©ºé–“**ï¼šæ¯å€‹ worktree éœ€è¦å®Œæ•´çš„å·¥ä½œç›®éŒ„ï¼ˆä¸å« .gitï¼‰
- **ä¾è³´å®‰è£**ï¼šæ¯å€‹ worktree éœ€è¦ç¨ç«‹å®‰è£ä¾è³´
- **è¨˜æ†¶é«”**ï¼šå¤šå€‹ worktree åŒæ™‚é‹è¡Œæœƒä½”ç”¨æ›´å¤šè¨˜æ†¶é«”

### ç·©è§£æ–¹æ¡ˆ

```bash
# ä½¿ç”¨ pnpm å…±äº«ä¾è³´ï¼ˆNode.js å°ˆæ¡ˆï¼‰
pnpm install

# å®šæœŸæ¸…ç†éæœŸ worktree
git worktree prune

# å®Œæˆå¾Œç«‹å³æ¸…ç†
git worktree remove .worktrees/{task-id}
```

### ä¸é©ç”¨å ´æ™¯

- å°å‹å°ˆæ¡ˆï¼ˆ< 1000 è¡Œï¼‰ï¼šæˆæœ¬å¤§æ–¼æ”¶ç›Š
- é »ç¹åˆ‡æ›çš„ä»»å‹™ï¼šworktree å»ºç«‹éœ€è¦æ™‚é–“
- å…±äº«ç‹€æ…‹çš„ä»»å‹™ï¼šéœ€è¦åœ¨åŒä¸€ç›®éŒ„æ“ä½œ

## å¸¸ç”¨æŒ‡ä»¤é€ŸæŸ¥

```bash
# åˆ—å‡ºæ‰€æœ‰ worktree
git worktree list

# å»ºç«‹ worktreeï¼ˆæ–°åˆ†æ”¯ï¼‰
git worktree add <path> -b <branch-name>

# å»ºç«‹ worktreeï¼ˆæ—¢æœ‰åˆ†æ”¯ï¼‰
git worktree add <path> <existing-branch>

# ç§»é™¤ worktree
git worktree remove <path>

# å¼·åˆ¶ç§»é™¤ï¼ˆæœ‰æœªæäº¤è®Šæ›´æ™‚ï¼‰
git worktree remove <path> --force

# æ¸…ç†éæœŸçš„ worktree å¼•ç”¨
git worktree prune

# é–å®š worktreeï¼ˆé˜²æ­¢è¢« pruneï¼‰
git worktree lock <path>
```

## ç›¸é—œè³‡æº

- [Git Worktree å®˜æ–¹æ–‡æª”](https://git-scm.com/docs/git-worktree)
- [superpowers:using-git-worktrees skill](https://github.com/anthropics/claude-code-skills)
- [CP0.5: Worktree æº–å‚™](../../02-checkpoints/_base/cp0.5-worktree-setup.md)
- [CP6.5: Worktree å®Œæˆ](../../02-checkpoints/_base/cp6.5-worktree-completion.md)
