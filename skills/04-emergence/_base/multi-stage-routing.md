# 多階路由 (Multi-Stage Routing)

> 根據任務複雜度和信心度，選擇適當的執行路徑

## 路由決策流程

```
任務輸入
    ↓
┌─────────────────────┐
│  Stage 1: 分類      │
│  - 任務類型識別     │
│  - 複雜度評估       │
└─────────────────────┘
    ↓
┌─────────────────────┐
│  Stage 2: 匹配      │
│  - 搜尋 Memory      │
│  - 搜尋 Skill       │
│  - 計算信心度       │
└─────────────────────┘
    ↓
┌─────────────────────┐
│  Stage 3: 路由      │
│  - 高信心 → 直接執行│
│  - 中信心 → 驗證後執│
│  - 低信心 → 研究模式│
└─────────────────────┘
```

## 信心度閾值

| 信心度 | 範圍 | 路由決策 |
|--------|------|----------|
| **高** | 80%+ | 直接執行，快速驗證 |
| **中** | 50-80% | 執行但增加檢查點 |
| **低** | <50% | 進入研究模式，先補充知識 |

## 研究模式

當整體信心度 < 50% 時：

```yaml
overall_confidence: 0.35
research_mode: true
research_suggestions:
  - 搜尋外部 skill 倉庫
  - Web 搜尋最佳實踐
  - 詢問用戶澄清具體需求

→ 不盲目執行，先補充知識再繼續
```

## 路由範例

### 高信心度路由

```
任務: 「優化 React 組件效能」
    ↓
Memory: 找到 3 筆相關經驗
Skill: 已載入 react-performance skill
信心度: 85%
    ↓
路由: 直接執行 PDCA
```

### 低信心度路由

```
任務: 「建立量子計算模擬器」
    ↓
Memory: 無相關經驗
Skill: 未找到匹配 skill
信心度: 15%
    ↓
路由: 研究模式
  1. Web 搜尋量子計算基礎
  2. 詢問用戶具體範圍
  3. 尋找相關 skill 或教程
```
