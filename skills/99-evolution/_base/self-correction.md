# 自我修正 (Self-Correction)

> 當策略失敗時，自動診斷原因並修正方向

## 修正觸發條件

| 條件 | 觸發 |
|------|------|
| PDCA Check 失敗 | 立即觸發 |
| 連續 2 次相同錯誤 | 強制診斷 |
| 達到迭代次數 50% | 檢查進度 |

## 失敗診斷框架

```
失敗發生
    ↓
┌─────────────────────────────────────────┐
│  失敗類型診斷                            │
│                                          │
│  A. 知識缺口 → 習得新 skill              │
│  B. 執行錯誤 → 重試 + 微調               │
│  C. 環境問題 → 檢查依賴/配置             │
│  D. 策略錯誤 → 切換策略                  │
│  E. 資源限制 → 降級/分解任務             │
└─────────────────────────────────────────┘
    ↓
修正行動
```

## 失敗類型詳解

### A. 知識缺口 (Knowledge Gap)

**症狀**: 不知道如何做、缺乏領域知識

**修正**:
1. 搜尋 Memory 中類似經驗
2. 搜尋可用 Skill
3. Web 搜尋相關知識
4. 若仍無法解決，提示用戶

### B. 執行錯誤 (Execution Error)

**症狀**: 知道怎麼做但執行出錯（語法錯誤、API 調用失敗）

**修正**:
1. 分析錯誤訊息
2. 微調參數或方法
3. 重試（最多 3 次）
4. 若持續失敗，切換策略

### C. 環境問題 (Environment Issue)

**症狀**: 缺少依賴、版本不符、權限不足

**修正**:
1. 檢查依賴是否安裝
2. 檢查版本相容性
3. 檢查權限設定
4. 提示用戶手動修復

### D. 策略錯誤 (Strategy Error)

**症狀**: 方向錯誤、方法不適用

**修正**:
1. 從策略池選擇替代方案
2. 若無替代方案，重新分析目標
3. 與用戶確認是否調整目標

### E. 資源限制 (Resource Limit)

**症狀**: 記憶體不足、時間超限、API 額度用盡

**修正**:
1. 降低任務複雜度
2. 分解為更小的子任務
3. 使用更輕量的方法
4. 提示用戶資源限制

## 修正記錄

每次修正後，記錄到 `.claude/memory/failures/`：

```yaml
---
date: YYYY-MM-DD
failure_type: A | B | C | D | E
original_strategy: [原策略]
correction_applied: [修正措施]
outcome: success | partial | failed
---

## 症狀
[問題描述]

## 診斷
[分析過程]

## 修正
[採取的措施]

## 結果
[修正後的結果]

## 教訓
[未來如何避免]
```

## 防止修正迴圈

```
修正次數 >= 3 且 問題相同
    ↓
停止自動修正
    ↓
提示用戶介入
    ↓
記錄為「需要人工處理」
```
